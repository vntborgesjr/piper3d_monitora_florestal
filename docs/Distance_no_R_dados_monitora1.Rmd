---
title: "Distance no R com dados 'modelo'"
output: html_notebook
---

Retirado do artigo Miller et al. (2019). Distance sampling in R. Journal of Statistical Sofware 89(1)

```{r setup}
# instalar pacotes necessários
#install.packages("Distance")

# instalar pacotes adicionais
#install.packages("mrds")
#install.packages("dsm")
#install.packages("mads")
#install.packages("dsims")

# carregar pacotes 
library(Distance)
library(dplyr)
library(DT)
library(flextable)
library(ggplot2)
library(lubridate)
library(plotly)
library(readr)
library(readxl)
library(stringr)
library(tibble)
library(tidyr)

# carregar as funções da pasta R
# carregar função script_carregar_funções_pasta_r.R
source(
  paste0(
    here::here(),
    "/R/minhas_funcoes.R"
  )
)

# carregar dados
cutia_tap_arap <- transformar_para_distanceR_covariaveis() |> 
  filter(
    Region.Label == "Resex Tapajos-Arapiuns",
    sp_name == "Dasyprocta croconota"
  ) |> 
  drop_na(distance)
  
# readr::write_excel_csv(
#   cutia_tap_arap,
#   paste0(
#     here::here(),
#     "/data/cutia_tap_arap.csv"
#   ),
# )

cutia_tap_arap <- cutia_tap_arap |> 
  select(
    Region.Label,
    Area,
    Sample.Label,
    Effort,
    distance
  ) 

cutia_tap_arap |> 
  DT::datatable(filter = "top")
```

```{r}
dados_completos |> 
  group_by(
    uc_name,
    ea_name
  ) |> 
  filter(day_effort == max(day_effort))  |> 
  drop_na(distance) |> 
  ungroup()
```

```{r}
dados_completos |> 
  filter(
    uc_name == "Resex Tapajos-Arapiuns",
    sp_name == "Dasyprocta croconota"
  ) |> 
  datatable(filter = list(position = "top"))
```

# Formatação do conjunto de dados

Variáveis necessárias para o `data.frame`:

-   `Region.Label`: vetor fator com o estrato contendo o transecto (pode ser uma estratificação pré-amostragem - UCs - ou pós-amostragem - ex. região, estado, bioma)

-   `Area`: vetor numérico contendo a área do estrato;

-   `Sample.Label`: vetor númerico contendo a identidade (ID) do transecto

-   `object`: nome adicional, ver seção 6;

-   `detected`: nome adicional, ver seção 6;

-   `Effort`: vetor númerico contendo o esforço do transecto (para linhas seu comprimento, para pontos o número de vezes que o ponto foi visitado)

-   `size`: vetor numérico copntendo o tamanho do grupo observado;

-   `distance`: vetor numérico de distâncias observadas;

-   `Month`:

-   `OBs`:

-   `Sp`:

-   `mas`:

-   `HAS`:

-   `Study.Area`:

Transectos que foram amostrados, mas que não tiveram observações (n = 0) devem ser incluídos no conjunto de dados com `NA` nas observações de distância e qualquer outra covariael para a qual não se tenha observação.

```{r}
# cutia_tap_arap |> 
#   complete(Region.Label, Sample.Label, sp_name) |> 
#   datatable(filter = list(position = "top"))
```

Jogar a imputacao de `NA`s pra dentro da funcao carregar dados completos.

## Determinando a distância para truncar os dados

```{r, fig.height=15, fig.width=10, warning=FALSE}
# desenha o grafico com a distribuicao de distancias perpendiculares
cutia_tap_arap |> 
  filter(distance >= 1,
         distance <= 14) |> 
  plotar_distribuicao_distancia_interativo()
```

```{r}
summary(cutia_tap_arap$distance)
```

## Ajustando funções de detecção no R

### Cutias da Resex Tapajós-Arapiuns para diferentes distâncias de truncamento

#### *Half-Normal* sem termos de ajuste e com termos de ajuste Cosseno e Polinomial de Hermite

Ajustando um modelo ao dados das cutias *Dasyprocta croconota*, configurando uma distância limite de 20m e usando *Half-normal* como *key function* usando o argumento `key`, sem termo de ajuste.

```{r}

cutia_tap_arap_filtrado <- cutia_tap_arap |> 
  filter(distance >= 1,
         distance <= 14)

# ajustando a função de detecção para uma distancia de truncamento de 20, 15, 10 e 5 metros
# dsitancias de truncamento
dist_truncamento <- list(
  `14 metros` = 14, 
  `12 metros` = 12, 
  `10 metros` = 10,
  `7 metros` = 7
)

# Key function - Half-normal 
cutia_tap_arap_hn <- purrr::map(
  dist_truncamento,
  \(.x) ajuste_modelos_distance_hn(
    cutia_tap_arap_filtrado, 
    truncamento = .x
  )
  )
```

```{r}
cutia_tap_arap_hn
```

#### *Hazard-Rate* sem termos de ajuste e com termos de ajuste Cosseno e Polinomial de Hermite

Ajustando um modelo ao dados da cutia *Dasyprocta croconota*, configurando uma distância limite de 20m e usando *Hazard rate* como *key function* usando o argumento `key`.

```{r}
# ajustando a função de detecção para uma distancia de truncamento de 20, 15, 10 e 5 metros
# Key function - Hazard-rate
cutia_tap_arap_hr <- purrr::map(
  dist_truncamento,
  \(.x) ajuste_modelos_distance_hr(
    cutia_tap_arap_filtrado, 
    truncamento = .x
  )
  )
```

#### *Uniform* sem termos de ajuste e com termos de ajuste Cosseno e Polinomial de Hermite

Ajustando um modelo ao dados das cutias *Dasyprocta croconota*, configurando uma distância limite de 20m e usando *Uniform* como *key function* usando o argumento `key`, sem termo de ajuste.

```{r}
# ajustando a função de detecção para uma distancia de truncamento de 20, 15, 10 e 5 metros
# Key function - Uniform
cutia_tap_arap_unif <- purrr::map(
  dist_truncamento,
  \(.x) ajuste_modelos_distance_unif(
    cutia_tap_arap, 
    truncamento = .x
  )
)
```

###### Seleção de modelos

```{r}
summarize_ds_models(
  cutia_tap_arap_hn$`14 metros`$`Sem termo`,
cutia_tap_arap_hn$`14 metros`$Cosseno,
  cutia_tap_arap_hn$`14 metros`$`Hermite polinomial`,
cutia_tap_arap_hr$`14 metros`$`Sem termo`,
cutia_tap_arap_hr$`14 metros`$Cosseno,
cutia_tap_arap_hr$`14 metros`$`Polinomial simples`,
cutia_tap_arap_unif$`14 metros`$Cosseno,
cutia_tap_arap_unif$`14 metros`$`Polinomial simples`
)
```

```{r}
summarize_ds_models(
  cutia_tap_arap_hn$`12 metros`$`Sem termo`,
cutia_tap_arap_hn$`12 metros`$Cosseno,
  cutia_tap_arap_hn$`12 metros`$`Hermite polinomial`,
cutia_tap_arap_hr$`12 metros`$`Sem termo`,
cutia_tap_arap_hr$`12 metros`$Cosseno,
cutia_tap_arap_hr$`12 metros`$`Polinomial simples`,
cutia_tap_arap_unif$`12 metros`$Cosseno,
cutia_tap_arap_unif$`12 metros`$`Polinomial simples`
)
```

```{r}
summarize_ds_models(
  cutia_tap_arap_hn$`10 metros`$`Sem termo`,
cutia_tap_arap_hn$`10 metros`$Cosseno,
  cutia_tap_arap_hn$`10 metros`$`Hermite polinomial`,
cutia_tap_arap_hr$`10 metros`$`Sem termo`,
cutia_tap_arap_hr$`10 metros`$Cosseno,
cutia_tap_arap_hr$`10 metros`$`Polinomial simples`,
cutia_tap_arap_unif$`10 metros`$Cosseno,
cutia_tap_arap_unif$`10 metros`$`Polinomial simples`
)
```

```{r}
summarize_ds_models(
  cutia_tap_arap_hn$`7 metros`$`Sem termo`,
cutia_tap_arap_hn$`7 metros`$Cosseno,
  cutia_tap_arap_hn$`7 metros`$`Hermite polinomial`,
cutia_tap_arap_hr$`7 metros`$`Sem termo`,
cutia_tap_arap_hr$`7 metros`$Cosseno,
cutia_tap_arap_hr$`7 metros`$`Polinomial simples`,
cutia_tap_arap_unif$`7 metros`$Cosseno,
cutia_tap_arap_unif$`7 metros`$`Polinomial simples`
)
```

#### Resumir o resultado dos modelos

O que tem que ter?

Os gráficos (probabilidade de detecção pela distância, com a curva ajustada, exemplo abaixo, fazer no ggplot), resultado do goodness of fit (gof_ds()), cada modelo vai ter que ter um nome diferente numa tabela(?)

```{r}
plot(cutia_tap_arap_hn, breaks = seq(0, 20, 2.5))
plot(cutia_tap_arap_hn_herm, breaks = seq(0, 20, 2.5))
plot(cutia_tap_arap_hn_cos, breaks = seq(0, 20, 2.5))
plot(cutia_tap_arap_hr, breaks = seq(0, 20, 2.5))
plot(cutia_tap_arap_hr_poly, breaks = seq(0, 20, 2.5))
plot(cutia_tap_arap_hr_cos, breaks = seq(0, 20, 2.5))
```

## Checagem e seleção de modelos

Podemos usar a função `summary` para obter informações importantes sobre o modelo.

```{r}

lista_modelos <- list(
  cutia_tap_arap_hn,
  cutia_tap_arap_hn_herm,
  cutia_tap_arap_hn_cos,
  cutia_tap_arap_hr,
  cutia_tap_arap_hr_poly,
  cutia_tap_arap_hr_cos
)

purrr::map(lista_modelos, \(x) summary(x))
```

```{r}
summarize_ds_models(
  cutia_tap_arap_hn,
  cutia_tap_arap_hn_herm,
  cutia_tap_arap_hn_cos,
  cutia_tap_arap_hr,
  cutia_tap_arap_hr_poly,
  cutia_tap_arap_hr_cos
)


```

O resultado inclui detalhes sobre o dado e a especificação do modelo, assim como dos coeficientes ($\beta_{j}$) e sua inceteza, a média do valor de detectabilidade e sua incerteza e uma estimativa da abundância na área coberta pela amostragem (sem levar em consideração o tamanho dos agrupamentos, ou bandos).

### Bondade de ajuste

Para visualizar quão bem a função de detecção se ajusta aos dados quanto temos as distâncias exatas podemos usar um plot de quantis empíricos x teóricos (Q-Q plot). Ele compara a função de distribuição cumulativa (CDF) dos valores ajustados da função detecção a distribuição empírica dos dados (EDF).

Também podemos usar o teste de Cramér-von Mises para testar se os pontos da EDF e da CDF tem origem na mesma distribuição. O teste usa a soma de todas as distâncias entre um ponto e a linha y = x para formar a estatística a ser testada. Um resultado significativo fornece evidência contra a hiipótese nula, sugerindo que o modelo não se ajusta bem aos dados.

```{r}
# ajustando um modelo Half-normal
cutia_hn <- ds(data = cutia_tap_arap_15,
                 truncation = 20,
                 transect = "line",
                 key = "hn", 
                 adjustment = NULL)

# conduzindo o teste dfe bondadede ajuste de Cramer-von Mises
gof_ds(cutia_hn)

gof_ds(cutia_hr_time)
```

O resutlado do teste aponta que o modelo *Half-normal* deve ser descartado.

Testes de bondade de ajuste de chi-quadrado são gerados usando a função `gof_ds` quando as distâncias forneceidas estão categorizadas.

### Seleção de Modelos

Uma vez que temos um conjunto de modelos plausíveis, podemos utilizar o cirtériode informaçãode Akaike (AIC) para selecionar entre os modelos o que melhor se ajusta aos dados utilizando a função `summarize_ds_models`.

```{r}
# gerando uma tabela de seleção de modelos usando AIC
summarize_ds_models(cutia_hn, cutia_hr_time, cutia_hr_time_size)
```

O melhor modelo é o Hazard-rate com tempo de senso e tamanho do grupo como covariáveis.

## Estimando a abundância e a variância

### Estimando abundância e variância no R

Para obter a abundância na região de estudo, primeiro calculamos a abundância na área amostrada para obter $N_c$ e em seguida escalonamos esse valor para toda a área de estudo multiplicando $N_c$ pela razão entre a área amostrada e a área da região. Para estimar a abundância na área amostrada, utilizamos as estimativas de probabilidade de detecção no estimador de Horvitz-Thompson.

Quando fornecemos os dados no formato correto ("flatfile") `ds` irá automaticamente calcular as estimativas de abundância baseado nas informações de amostragem presenta nos dados.

```{r}
summary(cutia_hn)
```

1.  Summary statistics: fornece as áreas, aŕea de amostragem, esforço, número de observações, número de transectos, taxa de encontro, seus erros padrões e coeficientes de variação para cada estrato;

2.  Abundance: fornece estimativas, erros padrões, coeficientesde variação, intervalos de confiança inferior e superior, graus de liberdade para a estimativa de abundância de cada estrato;

3.  Densidade: lista as mesmas estatísticas de Abundance, só que para densidade.

## **Funções Exploratórias Adicionais**

`contar_n_repeticoes_trilha()` - conta o número de vezes que cada trilha foi visitada

## Adicionando covariavel

Ajuste *Hermite pollynomial* usa od código `"herm"` e polinomial simples `"poly"`.

Podemos incluir covariáveis utilizando o argumento `formula = ~ ...`. Abaixo, está especificado um modelo "Hazard-rate" para os dados de cutia q ue inclui o tempo de senso como covariável e uma distância limite de 20m.

```{r}
cutia_hr_time <- cutia_tap_arap_15 |> 
  ds(truncation = 20,
     key = "hr",
     formula = ~ cense_time)
```

Adicionando uma segunda covariável: tamanho do grupo.

```{r}
cutia_hr_time_size <- ds(data = cutia_tap_arap_15,
                     truncation = 20,
                     transect = "line",
                     key = "hr",
                     formula = ~ cense_time + size)
```

```{r}
plot(cutia_hr_time)
plot(cutia_hr_time_size)
```

### Cutias da ESEC Terra do Meio para diferentes distâncias de truncamento

```{r}
cutia_esec_terra_meio <- transformar_para_distanceR_covariaveis() |> 
  filter(
    Region.Label == "Esec da Terra do Meio",
    sp_name == "Dasyprocta croconota"
  ) |> 
  drop_na(distance)
  
```

```{r}
# desenha o grafico com a distribuicao de distancias perpendiculares
cutia_esec_terra_meio |> 
  filter(distance >= 1,
         distance < 15) |> 
  plotar_distribuicao_distancia_interativo(largura_caixa = 1)
```

#### *Half-Normal* sem termos de ajuste e com termos de ajuste Cosseno e Polinomial de Hermite

Ajustando um modelo ao dados das cutias *Dasyprocta croconota*, configurando uma distância limite de 20m e usando *Half-normal* como *key function* usando o argumento `key`, sem termo de ajuste.

```{r}
cutia_esec_terra_meio_filtrado
```

```{r}
cutia_esec_terra_meio_filtrado <- cutia_esec_terra_meio |> 
  filter(distance >= 1,
         distance < 15)
# ajustando a função de detecção para uma distancia de truncamento de 20, 15, 10 e 5 metros
# dsitancias de truncamento
dist_truncamento <- list(
  #`20 metros` = 20, 
  `15 metros` = 15, 
  `12 metros` = 12,
  `10 metros` = 10
)

# Key function - Half-normal 
cutia_esec_terra_meio_hn <- purrr::map(
  dist_truncamento,
  \(.x) ajuste_modelos_distance_hn(
    cutia_esec_terra_meio_filtrado, 
    truncamento = .x
  )
  )
```

```{r}
cutia_esec_terra_meio_hn
```

#### *Hazard-Rate* sem termos de ajuste e com termos de ajuste Cosseno e Polinomial de Hermite

Ajustando um modelo ao dados da cutia *Dasyprocta croconota*, configurando uma distância limite de 20m e usando *Hazard rate* como *key function* usando o argumento `key`.

```{r}
# ajustando a função de detecção para uma distancia de truncamento de 20, 15, 10 e 5 metros
# Key function - Hazard-rate
cutia_esec_terra_meio_hr <- purrr::map(
  dist_truncamento,
  \(.x) ajuste_modelos_distance_hr(
    cutia_esec_terra_meio_filtrado, 
    truncamento = .x
  )
  )
```

#### *Uniform* sem termos de ajuste e com termos de ajuste Cosseno e Polinomial de Hermite

Ajustando um modelo ao dados das cutias *Dasyprocta croconota*, configurando uma distância limite de 20m e usando *Uniform* como *key function* usando o argumento `key`, sem termo de ajuste.

```{r}
# ajustando a função de detecção para uma distancia de truncamento de 20, 15, 10 e 5 metros
# Key function - Uniform
cutia_esec_terra_meio_unif <- purrr::map(
  dist_truncamento,
  \(.x) ajuste_modelos_distance_unif(
    cutia_tap_arap, 
    truncamento = .x
  )
  )
```

###### Seleção de modelos

```{r}
summarize_ds_models(
  cutia_esec_terra_meio_hn$`20 metros`$`Sem termo`,
cutia_esec_terra_meio_hn$`20 metros`$Cosseno,
  cutia_esec_terra_meio_hn$`20 metros`$`Hermite polinomial`,
cutia_esec_terra_meio_hr$`20 metros`$`Sem termo`,
cutia_esec_terra_meio_hr$`20 metros`$Cosseno,
cutia_esec_terra_meio_hr$`20 metros`$`Polinomial simples`,
cutia_esec_terra_meio_unif$`20 metros`$Cosseno,
cutia_esec_terra_meio_unif$`20 metros`$`Polinomial simples`
)
```

```{r}
summarize_ds_models(
  cutia_esec_terra_meio_hn$`15 metros`$`Sem termo`,
cutia_esec_terra_meio_hn$`15 metros`$Cosseno,
  cutia_esec_terra_meio_hn$`15 metros`$`Hermite polinomial`,
cutia_esec_terra_meio_hr$`15 metros`$`Sem termo`,
cutia_esec_terra_meio_hr$`15 metros`$Cosseno,
cutia_esec_terra_meio_hr$`15 metros`$`Polinomial simples`,
cutia_esec_terra_meio_unif$`15 metros`$Cosseno,
cutia_esec_terra_meio_unif$`15 metros`$`Polinomial simples`
)
```

```{r}
summarize_ds_models(
  cutia_esec_terra_meio_hn$`10 metros`$`Sem termo`,
cutia_esec_terra_meio_hn$`10 metros`$Cosseno,
  cutia_esec_terra_meio_hn$`10 metros`$`Hermite polinomial`,
cutia_esec_terra_meio_hr$`10 metros`$`Sem termo`,
cutia_esec_terra_meio_hr$`10 metros`$Cosseno,
cutia_esec_terra_meio_hr$`10 metros`$`Polinomial simples`,
cutia_esec_terra_meio_unif$`10 metros`$Cosseno,
cutia_esec_terra_meio_unif$`10 metros`$`Polinomial simples`
)
```

```{r}
summarize_ds_models(
  cutia_esec_terra_meio_hn$`12 metros`$`Sem termo`,
cutia_esec_terra_meio_hn$`12 metros`$Cosseno,
  cutia_esec_terra_meio_hn$`12 metros`$`Hermite polinomial`,
cutia_esec_terra_meio_hr$`12 metros`$`Sem termo`,
cutia_esec_terra_meio_hr$`12 metros`$Cosseno,
cutia_esec_terra_meio_hr$`12 metros`$`Polinomial simples`,
cutia_esec_terra_meio_unif$`12 metros`$Cosseno,
cutia_esec_terra_meio_unif$`12 metros`$`Polinomial simples`
)
```

### Cutias da Parna da Serra do Pardo para diferentes distâncias de truncamento

```{r}
cutia_parna_serra_pardo <- transformar_para_distanceR_covariaveis() |> 
  filter(
    Region.Label == "Parna da Serra do Pardo",
    sp_name == "Dasyprocta croconota"
  ) |> 
  drop_na(distance)
  
```

```{r}
# desenha o grafico com a distribuicao de distancias perpendiculares
cutia_parna_serra_pardo |> 
  filter(distance < 15,
         distance > 0) |> 
  plotar_distribuicao_distancia_interativo()
```

#### *Half-Normal* sem termos de ajuste e com termos de ajuste Cosseno e Polinomial de Hermite

Ajustando um modelo ao dados das cutias *Dasyprocta croconota*, configurando uma distância limite de 20m e usando *Half-normal* como *key function* usando o argumento `key`, sem termo de ajuste.

```{r}
# ajustando a função de detecção para uma distancia de truncamento de 20, 15, 10 e 5 metros
# dsitancias de truncamento
dist_truncamento <- list(
  `20 metros` = 20, 
  `15 metros` = 15, 
  `10 metros` = 10,
  `5 metros` = 5
)

# Key function - Half-normal 
cutia_parna_serra_pardo_hn <- purrr::map(
  dist_truncamento,
  \(.x) ajuste_modelos_distance_hn(
    cutia_parna_serra_pardo, 
    truncamento = .x
  )
  )
```

```{r}
cutia_parna_serra_pardo_hn
```

#### *Hazard-Rate* sem termos de ajuste e com termos de ajuste Cosseno e Polinomial de Hermite

Ajustando um modelo ao dados da cutia *Dasyprocta croconota*, configurando uma distância limite de 20m e usando *Hazard rate* como *key function* usando o argumento `key`.

```{r}
# ajustando a função de detecção para uma distancia de truncamento de 20, 15, 10 e 5 metros
# Key function - Hazard-rate
cutia_parna_serra_pardo_hr <- purrr::map(
  dist_truncamento,
  \(.x) ajuste_modelos_distance_hr(
    cutia_parna_serra_pardo, 
    truncamento = .x
  )
  )
```

#### *Uniform* sem termos de ajuste e com termos de ajuste Cosseno e Polinomial de Hermite

Ajustando um modelo ao dados das cutias *Dasyprocta croconota*, configurando uma distância limite de 20m e usando *Uniform* como *key function* usando o argumento `key`, sem termo de ajuste.

```{r}
# ajustando a função de detecção para uma distancia de truncamento de 20, 15, 10 e 5 metros
# Key function - Uniform
cutia_parna_serra_pardo_unif <- purrr::map(
  dist_truncamento,
  \(.x) ajuste_modelos_distance_unif(
    cutia_parna_serra_pardo, 
    truncamento = .x
  )
)
```

###### Seleção de modelos

```{r}
summarize_ds_models(
  cutia_parna_serra_pardo_hn$`20 metros`$`Sem termo`,
cutia_parna_serra_pardo_hn$`20 metros`$Cosseno,
  cutia_parna_serra_pardo_hn$`20 metros`$`Hermite polinomial`,
cutia_parna_serra_pardo_hr$`20 metros`$`Sem termo`,
cutia_parna_serra_pardo_hr$`20 metros`$Cosseno,
cutia_parna_serra_pardo_hr$`20 metros`$`Polinomial simples`,
cutia_parna_serra_pardo_unif$`20 metros`$Cosseno,
cutia_parna_serra_pardo_unif$`20 metros`$`Polinomial simples`
)
```

```{r}
summarize_ds_models(
  cutia_parna_serra_pardo_hn$`15 metros`$`Sem termo`,
cutia_parna_serra_pardo_hn$`15 metros`$Cosseno,
  cutia_parna_serra_pardo_hn$`15 metros`$`Hermite polinomial`,
cutia_parna_serra_pardo_hr$`15 metros`$`Sem termo`,
cutia_parna_serra_pardo_hr$`15 metros`$Cosseno,
cutia_parna_serra_pardo_hr$`15 metros`$`Polinomial simples`,
cutia_parna_serra_pardo_unif$`15 metros`$Cosseno,
cutia_parna_serra_pardo_unif$`15 metros`$`Polinomial simples`
)
```

```{r}
summarize_ds_models(
  cutia_parna_serra_pardo_hn$`10 metros`$`Sem termo`,
cutia_parna_serra_pardo_hn$`10 metros`$Cosseno,
  cutia_parna_serra_pardo_hn$`10 metros`$`Hermite polinomial`,
cutia_parna_serra_pardo_hr$`10 metros`$`Sem termo`,
cutia_parna_serra_pardo_hr$`10 metros`$Cosseno,
cutia_parna_serra_pardo_hr$`10 metros`$`Polinomial simples`,
cutia_parna_serra_pardo_unif$`10 metros`$`Sem termo`,
cutia_parna_serra_pardo_unif$`10 metros`$Cosseno,
cutia_parna_serra_pardo_unif$`10 metros`$`Polinomial simples`
)
```

```{r}
summarize_ds_models(
  cutia_parna_serra_pardo_hn$`5 metros`$`Sem termo`,
cutia_parna_serra_pardo_hn$`5 metros`$Cosseno,
  cutia_parna_serra_pardo_hn$`5 metros`$`Hermite polinomial`,
cutia_parna_serra_pardo_hr$`5 metros`$`Sem termo`,
cutia_parna_serra_pardo_hr$`5 metros`$Cosseno,
cutia_parna_serra_pardo_hr$`5 metros`$`Polinomial simples`,
cutia_parna_serra_pardo_unif$`5 metros`$`Sem termo`,
cutia_parna_serra_pardo_unif$`5 metros`$Cosseno,
cutia_parna_serra_pardo_unif$`5 metros`$`Polinomial simples`
)
```

##### Tentativa de fazer a seleçã ode modelos usando purrr - tentar aninhar mais um map

```{r}
purrr::map_df(
  list(
    cutia_esec_terra_meio_hn$`20 metros`,
    cutia_esec_terra_meio_hr$`20 metros`
  ),
  \(.x) purrr::map_df(.x, \(.y) summarize_ds_models(.y))
)

purrr::map_df(
  cutia_esec_terra_meio_hn$`15 metros`,
  \(.x) summarize_ds_models(.x)
)

purrr::map_df(
  cutia_esec_terra_meio_hn$`10 metros`,
  \(.x) summarize_ds_models(.x)
)

purrr::map_df(
  cutia_esec_terra_meio_hn$`5 metros`,
  \(.x) summarize_ds_models(.x)
)
```

```{r}

```

# Primeira espécie para dados com repetição

## *Saguinus midas* no **Parna Montanhas do Tumucumaque**

![Fonte: datuopinion.com](https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Ftse4.mm.bing.net%2Fth%3Fid%3DOIP.MKXKT9lNOTspnocS9qpgJAHaFO%26pid%3DApi&f=1&ipt=baacdeefff20d2cc79d1cc7beba75bbb85546c4b53a4ba3305f4cca2e1f2e592&ipo=images)

### Carregar dados

```{r}
sagui_mont_tumuc <- transformar_para_distanceR_covariaveis() |> 
  filter(
    Region.Label == "Parna Montanhas do Tumucumaque",
    sp_name == "Saguinus midas"
  ) |> 
  drop_na(distance)
```

### Distribuição das distâncias perpendiculares

```{r}
sagui_mont_tumuc |> 
  plotar_distribuicao_distancia_interativo()
```

### Ajustando modelo distance com função de detecção Half-Normal e distancia de truncamento 10

```{r}
sagui_mont_tumuc_hn <- sagui_mont_tumuc |> 
  ajuste_modelos_distance_hn(truncamento = 10)
```

### Ajustando modelo distance com função de detecção Hazard-rate e distancia de truncamento 10

```{r}
sagui_mont_tumuc_hr <- sagui_mont_tumuc |> 
  ajuste_modelos_distance_hr(truncamento = 10)
```

### Plot dos modelos

```{r}
sagui_mont_tumuc_hn |> 
  purrr::map(\(.x) plot(.x)) 
```

```{r}
sagui_mont_tumuc_hr |> 
  purrr::map(\(.x) plot(.x)) 
```

### Seleção de modelos

```{r}
summarize_ds_models(
  sagui_mont_tumuc_hn$`Sem termo`,
  sagui_mont_tumuc_hn$Cosseno,
  sagui_mont_tumuc_hn$`Hermite polinomial`,
  sagui_mont_tumuc_hr$`Sem termo`,
  sagui_mont_tumuc_hr$Cosseno,
  sagui_mont_tumuc_hr$`Polinomial simples`
)
```

### Teste de bondade de ajuste

```{r}
sagui_mont_tumuc_hn |> 
  purrr::map(\(.x) gof_ds(model = .x))
```

```{r}
sagui_mont_tumuc_hr |> 
  purrr::map(\(.x) gof_ds(model = .x))
```

### Estimando a abundancia

```{r}
# área de estudo, tamanho da área de estudo, area coberta pelo esforço amostral, esforço amostral em metros, número de detecções, número de transectos (ea), taxa de encontro, coeficiente de variação da taxa de encontro  
sagui_mont_tumuc_hn$`Sem termo`$dht$individuals$summary[1:9]
```

```{r}
# área de estudo, tamanho da área de estudo, trilhas ou estações amostrais, esforço total em cada trilha, abundância estimada em cada estação amostral, número de detecções em cada estação amostral, área total amostrada
sagui_mont_tumuc_hn$`Sem termo`$dht$individuals$Nhat.by.sample[1:8]
```

```{r}
# total, densidade estimada, erro padrão da densidade destimada, coeficiente de variação da densidade destimada, intervalo de confiança inferior e superior do coeficiente de variação, gruas de liberdade
sagui_mont_tumuc_hn$`Sem termo`$dht$individuals$D

```

```{r}
# área de estudo, tamanho da área de estudo, area coberta pelo esforço amostral, esforço amostral em metros, número de detecções, número de transectos (ea), taxa de encontro, coeficiente de variação da taxa de encontro  
sagui_mont_tumuc_hr$`Sem termo`$dht$individuals$summary[1:9]
```

```{r}
# área de estudo, tamanho da área de estudo, trilhas ou estações amostrais, esforço total em cada trilha, abundância estimada em cada estação amostral, número de detecções em cada estação amostral, área total amostrada
sagui_mont_tumuc_hr$`Sem termo`$dht$individuals$Nhat.by.sample[1:8]
```

```{r}
# total, densidade estimada, erro padrão da densidade destimada, coeficiente de variação da densidade destimada, intervalo de confiança inferior e superior do coeficiente de variação, gruas de liberdade
sagui_mont_tumuc_hr$`Sem termo`$dht$individuals$D
```

# Segunda espécie para dados com repetição

## *Myoprocta pratti* na **Resex Alto Tarauacá**

![Fonte: zoochat.com](https://external-content.duckduckgo.com/iu/?u=https%253A%252F%252Ftse3.mm.bing.net%252Fth%253Fid%253DOIP.hqCNuSZSYZYfF_hTuoFlWAHaE8%2526pid%253DApi&f=1&ipt=6708c08de380fff37267c88563c4958653de6bc88c44979b20f2fd7ffcbbad4a&ipo=images)

### Carregar dados

```{r}
cutia_alto_tarau <- transformar_para_distanceR_covariaveis() |> 
  filter(
    Region.Label == "Resex Alto Tarauacá",
    sp_name == "Myoprocta pratti"
  ) |> 
  drop_na(distance)
```

### Distribuição das distâncias perpendiculares

```{r}
cutia_alto_tarau |> 
  plotar_distribuicao_distancia_interativo()
```

### Ajustando modelo distance com função de detecção Half-Normal e distancia de truncamento 10

```{r}
cutia_alto_tarau_hn <- cutia_alto_tarau |> 
  ajuste_modelos_distance_hn(truncamento = 10)
```

### Ajustando modelo distance com função de detecção Hazard-rate e distancia de truncamento 10

```{r}
cutia_alto_tarau_hr <- cutia_alto_tarau |> 
  ajuste_modelos_distance_hr(truncamento = 10)
```

### Plot dos modelos

```{r}
cutia_alto_tarau_hn |> 
  purrr::map(\(.x) plot(.x)) 
```

```{r}
cutia_alto_tarau_hr |> 
  purrr::map(\(.x) plot(.x)) 
```

### Seleção de modelos

```{r}
summarize_ds_models(
  cutia_alto_tarau_hn$`Sem termo`,
  cutia_alto_tarau_hn$Cosseno,
  cutia_alto_tarau_hn$`Hermite polinomial`,
  cutia_alto_tarau_hr$`Sem termo`,
  cutia_alto_tarau_hr$Cosseno,
  cutia_alto_tarau_hr$`Polinomial simples`
)
```

### Teste de bondade de ajuste

```{r}
cutia_alto_tarau_hn |> 
  purrr::map(\(.x) gof_ds(model = .x))
```

```{r}
cutia_alto_tarau_hr |> 
  purrr::map(\(.x) gof_ds(model = .x))
```

### Estimando a abundancia

```{r}
# área de estudo, tamanho da área de estudo, area coberta pelo esforço amostral, esforço amostral em metros, número de detecções, número de transectos (ea), taxa de encontro, coeficiente de variação da taxa de encontro  
cutia_alto_tarau_hn$`Sem termo`$dht$individuals$summary[1:9]
```

```{r}
# área de estudo, tamanho da área de estudo, trilhas ou estações amostrais, esforço total em cada trilha, abundância estimada em cada estação amostral, número de detecções em cada estação amostral, área total amostrada
cutia_alto_tarau_hn$`Sem termo`$dht$individuals$Nhat.by.sample[1:8]
```

```{r}
# total, densidade estimada, erro padrão da densidade destimada, coeficiente de variação da densidade destimada, intervalo de confiança inferior e superior do coeficiente de variação, gruas de liberdade
cutia_alto_tarau_hn$`Sem termo`$dht$individuals$D

```

```{r}
# área de estudo, tamanho da área de estudo, area coberta pelo esforço amostral, esforço amostral em metros, número de detecções, número de transectos (ea), taxa de encontro, coeficiente de variação da taxa de encontro  
cutia_alto_tarau_hr$`Sem termo`$dht$individuals$summary[1:9]
```

```{r}
# área de estudo, tamanho da área de estudo, trilhas ou estações amostrais, esforço total em cada trilha, abundância estimada em cada estação amostral, número de detecções em cada estação amostral, área total amostrada
cutia_alto_tarau_hr$`Sem termo`$dht$individuals$Nhat.by.sample[1:8]
```

```{r}
# total, densidade estimada, erro padrão da densidade destimada, coeficiente de variação da densidade destimada, intervalo de confiança inferior e superior do coeficiente de variação, gruas de liberdade
cutia_alto_tarau_hr$`Sem termo`$dht$individuals$D

```

# Terceira espécie para dados com repetição

## *Lagothrix cana* na **Rebio do Jaru**

![Fonte: zoochat.com](https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Ftse1.mm.bing.net%2Fth%3Fid%3DOIP.wNKxS8e_CGO89TOOoTy-ywHaE8%26pid%3DApi&f=1&ipt=43306d74ae7f05cf0c98b98bfac7d113fbb4031c267e5efae616fb999dc64dd0&ipo=images)

### Carregar dados

```{r}
macaco_jaru <- transformar_para_distanceR_covariaveis() |> 
  filter(
    Region.Label == "Rebio do Jaru",
    sp_name == "Lagothrix cana"
  ) |> 
  drop_na(distance)
```

### Distribuição das distâncias perpendiculares

```{r}
macaco_jaru |> 
  plotar_distribuicao_distancia_interativo()
```

### Ajustando modelo distance com função de detecção Half-Normal e distancia de truncamento 20

```{r}
macaco_jaru_hn <- macaco_jaru |> 
  ajuste_modelos_distance_hn(truncamento = 20)
```

### Ajustando modelo distance com função de detecção Hazard-rate e distancia de truncamento 20

```{r}
macaco_jaru_hr <- macaco_jaru |> 
  ajuste_modelos_distance_hr(truncamento = 20)
```

### Plot dos modelos

```{r}
macaco_jaru_hn |> 
  purrr::map(\(.x) plot(.x)) 
```

```{r}
macaco_jaru_hr |> 
  purrr::map(\(.x) plot(.x)) 
```

### Seleção de modelos

```{r}
summarize_ds_models(
  macaco_jaru_hn$`Sem termo`,
  macaco_jaru_hn$Cosseno,
  macaco_jaru_hn$`Hermite polinomial`,
  macaco_jaru_hr$`Sem termo`,
  macaco_jaru_hr$Cosseno,
  macaco_jaru_hr$`Polinomial simples`
)
```

### Teste de bondade de ajuste

```{r}
macaco_jaru_hn |> 
  purrr::map(\(.x) gof_ds(model = .x))
```

```{r}
macaco_jaru_hr |> 
  purrr::map(\(.x) gof_ds(model = .x))
```

### Estimando a abundancia

```{r}
# área de estudo, tamanho da área de estudo, area coberta pelo esforço amostral, esforço amostral em metros, número de detecções, número de transectos (ea), taxa de encontro, coeficiente de variação da taxa de encontro  
macaco_jaru_hn$`Sem termo`$dht$individuals$summary[1:9]
```

```{r}
# área de estudo, tamanho da área de estudo, trilhas ou estações amostrais, esforço total em cada trilha, abundância estimada em cada estação amostral, número de detecções em cada estação amostral, área total amostrada
macaco_jaru_hn$`Sem termo`$dht$individuals$Nhat.by.sample[1:8]
```

```{r}
# total, densidade estimada, erro padrão da densidade destimada, coeficiente de variação da densidade destimada, intervalo de confiança inferior e superior do coeficiente de variação, gruas de liberdade
macaco_jaru_hn$`Sem termo`$dht$individuals$D

```

```{r}
# área de estudo, tamanho da área de estudo, area coberta pelo esforço amostral, esforço amostral em metros, número de detecções, número de transectos (ea), taxa de encontro, coeficiente de variação da taxa de encontro  
macaco_jaru_hr$`Sem termo`$dht$individuals$summary[1:9]
```

```{r}
# área de estudo, tamanho da área de estudo, trilhas ou estações amostrais, esforço total em cada trilha, abundância estimada em cada estação amostral, número de detecções em cada estação amostral, área total amostrada
macaco_jaru_hr$`Sem termo`$dht$individuals$Nhat.by.sample[1:8]
```

```{r}
# total, densidade estimada, erro padrão da densidade destimada, coeficiente de variação da densidade destimada, intervalo de confiança inferior e superior do coeficiente de variação, gruas de liberdade
macaco_jaru_hr$`Sem termo`$dht$individuals$D

```

# Quarta espécie para dados com repetição

## *Mazama americana* na **Resex Tapajos-Arapiuns**

![Fonte: zoochat.com](https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Ftse2.mm.bing.net%2Fth%3Fid%3DOIP.V7M0mCIe5bFtJMv4O04jgAHaE8%26pid%3DApi&f=1&ipt=81f27ed3e2882badba619d12c798f2c29c896bd70cb71f6da91902c13dfbb06f&ipo=images)

### Carregar dados

```{r}
cervo_tap_arap <- transformar_para_distanceR_covariaveis() |> 
  filter(
    Region.Label == "Resex Tapajos-Arapiuns",
    sp_name == "Mazama americana"
  ) |> 
  drop_na(distance)
```

### Distribuição das distâncias perpendiculares

```{r}
cervo_tap_arap |> 
  plotar_distribuicao_distancia_interativo()
```

### Ajustando modelo distance com função de detecção Half-Normal e distancia de truncamento 13

```{r}
cervo_tap_arap_hn <- cervo_tap_arap |> 
  ajuste_modelos_distance_hn(truncamento = 13)
```

### Ajustando modelo distance com função de detecção Hazard-rate e distancia de truncamento 13

```{r}
cervo_tap_arap_hr <- cervo_tap_arap |> 
  ajuste_modelos_distance_hr(truncamento = 13)
```

### Plot dos modelos

```{r}
cervo_tap_arap_hn |> 
  purrr::map(\(.x) plot(.x)) 
```

```{r}
cervo_tap_arap_hr |> 
  purrr::map(\(.x) plot(.x)) 
```

### Seleção de modelos

```{r}
summarize_ds_models(
  cervo_tap_arap_hn$`Sem termo`,
  cervo_tap_arap_hn$Cosseno,
  cervo_tap_arap_hn$`Hermite polinomial`,
  cervo_tap_arap_hr$`Sem termo`,
  cervo_tap_arap_hr$Cosseno,
  cervo_tap_arap_hr$`Polinomial simples`
)
```

### Teste de bondade de ajuste

```{r}
cervo_tap_arap_hn |> 
  purrr::map(\(.x) gof_ds(model = .x))
```

```{r}
cervo_tap_arap_hr |> 
  purrr::map(\(.x) gof_ds(model = .x))
```

### Estimando a abundancia

```{r}
# área de estudo, tamanho da área de estudo, area coberta pelo esforço amostral, esforço amostral em metros, número de detecções, número de transectos (ea), taxa de encontro, coeficiente de variação da taxa de encontro  
cervo_tap_arap_hn$`Sem termo`$dht$individuals$summary[1:9]
```

```{r}
# área de estudo, tamanho da área de estudo, trilhas ou estações amostrais, esforço total em cada trilha, abundância estimada em cada estação amostral, número de detecções em cada estação amostral, área total amostrada
cervo_tap_arap_hn$`Sem termo`$dht$individuals$Nhat.by.sample[1:8]
```

```{r}
# total, densidade estimada, erro padrão da densidade destimada, coeficiente de variação da densidade destimada, intervalo de confiança inferior e superior do coeficiente de variação, gruas de liberdade
cervo_tap_arap_hn$`Sem termo`$dht$individuals$D

```

```{r}
# área de estudo, tamanho da área de estudo, area coberta pelo esforço amostral, esforço amostral em metros, número de detecções, número de transectos (ea), taxa de encontro, coeficiente de variação da taxa de encontro  
cervo_tap_arap_hr$`Sem termo`$dht$individuals$summary[1:9]
```

```{r}
# área de estudo, tamanho da área de estudo, trilhas ou estações amostrais, esforço total em cada trilha, abundância estimada em cada estação amostral, número de detecções em cada estação amostral, área total amostrada
cervo_tap_arap_hr$`Sem termo`$dht$individuals$Nhat.by.sample[1:8]
```

```{r}
# total, densidade estimada, erro padrão da densidade destimada, coeficiente de variação da densidade destimada, intervalo de confiança inferior e superior do coeficiente de variação, gruas de liberdade
cervo_tap_arap_hr$`Sem termo`$dht$individuals$D

```

# Quinta espécie para dados com repetição

## *Tinamus major* na **Parna Montanhas do Tumucumaque**

![Fonte: pinterest.com](https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Ftse1.mm.bing.net%2Fth%3Fid%3DOIP.3mG-yVZq9vN0aOITB7ltpgHaEr%26pid%3DApi&f=1&ipt=bdec34d393bcaddd9cedcedb81daa6496680619f13d704b6d419ff516e5b5210&ipo=images)

### Carregar dados

```{r}
inambu_mont_tumuc <- transformar_para_distanceR_covariaveis() |> 
  filter(
    Region.Label == "Parna Montanhas do Tumucumaque",
    sp_name == "Tinamus major"
  ) |> 
  drop_na(distance)
```

### Distribuição das distâncias perpendiculares

```{r}
inambu_mont_tumuc |> 
  plotar_distribuicao_distancia_interativo()
```

### Ajustando modelo distance com função de detecção Half-Normal e distancia de truncamento 15

```{r}
inambu_mont_tumuc_hn <- inambu_mont_tumuc |> 
  ajuste_modelos_distance_hn(truncamento = 15)
```

### Ajustando modelo distance com função de detecção Hazard-rate e distancia de truncamento 15

```{r}
inambu_mont_tumuc_hr <- inambu_mont_tumuc |> 
  ajuste_modelos_distance_hr(truncamento = 15)
```

### Plot dos modelos

```{r}
inambu_mont_tumuc_hn |> 
  purrr::map(\(.x) plot(.x)) 
```

```{r}
inambu_mont_tumuc_hr |> 
  purrr::map(\(.x) plot(.x)) 
```

### Seleção de modelos

```{r}
summarize_ds_models(
  inambu_mont_tumuc_hn$`Sem termo`,
  inambu_mont_tumuc_hn$Cosseno,
  inambu_mont_tumuc_hn$`Hermite polinomial`,
  inambu_mont_tumuc_hr$`Sem termo`,
  inambu_mont_tumuc_hr$Cosseno,
  inambu_mont_tumuc_hr$`Polinomial simples`
)
```

### Teste de bondade de ajuste

```{r}
inambu_mont_tumuc_hn |> 
  purrr::map(\(.x) gof_ds(model = .x))
```

```{r}
inambu_mont_tumuc_hr |> 
  purrr::map(\(.x) gof_ds(model = .x))
```

### Estimando a abundancia

```{r}
# área de estudo, tamanho da área de estudo, area coberta pelo esforço amostral, esforço amostral em metros, número de detecções, número de transectos (ea), taxa de encontro, coeficiente de variação da taxa de encontro  
inambu_mont_tumuc_hn$`Sem termo`$dht$individuals$summary[1:9]
```

```{r}
# área de estudo, tamanho da área de estudo, trilhas ou estações amostrais, esforço total em cada trilha, abundância estimada em cada estação amostral, número de detecções em cada estação amostral, área total amostrada
inambu_mont_tumuc_hn$`Sem termo`$dht$individuals$Nhat.by.sample[1:8]
```

```{r}
# total, densidade estimada, erro padrão da densidade destimada, coeficiente de variação da densidade destimada, intervalo de confiança inferior e superior do coeficiente de variação, gruas de liberdade
inambu_mont_tumuc_hn$`Sem termo`$dht$individuals$D

```

```{r}
# área de estudo, tamanho da área de estudo, area coberta pelo esforço amostral, esforço amostral em metros, número de detecções, número de transectos (ea), taxa de encontro, coeficiente de variação da taxa de encontro  
inambu_mont_tumuc_hr$`Sem termo`$dht$individuals$summary[1:9]
```

```{r}
# área de estudo, tamanho da área de estudo, trilhas ou estações amostrais, esforço total em cada trilha, abundância estimada em cada estação amostral, número de detecções em cada estação amostral, área total amostrada
inambu_mont_tumuc_hr$`Sem termo`$dht$individuals$Nhat.by.sample[1:8]
```

```{r}
# total, densidade estimada, erro padrão da densidade destimada, coeficiente de variação da densidade destimada, intervalo de confiança inferior e superior do coeficiente de variação, gruas de liberdade
inambu_mont_tumuc_hr$`Sem termo`$dht$individuals$D

```
